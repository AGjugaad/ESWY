<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ESWY</title>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <div id="termsModal" class="modal">
    <div class="modal-content">
      <p>The audio ahead contains a jumble of highly potent cosmic frequencies. Listening to it may cause:</p>

      <div style="margin-left: 1em; line-height: 1.6;">
        <div>— Unregulated flashbacks of past lives</div>
        <div>— An unshakable thought that you don’t belong here</div>
        <div>— Fear of dying in bizarre ways</div>
        <div>— A deep yearning that cannot be fixed</div>
        <div>— A clear view of the Truth</div>
        <div>— A fixing of the soul</div>
      </div>
      
      <p>If you think you can handle said side effects, <strong>ESWY</strong>, the song awaits you.<br>
      <small>(issued by ESWY Pvt. Ltd.)</small></p>
      
        <button id="yeswyButton">yeswy</button>
    </div>
</div>
  <style>
    html, body {
      cursor: url('cursor1.png'), auto;
      margin: 0;
      padding: 0;
      height: 100%;
      min-height: 100vh;
      overflow-x: hidden;
      background-image: url('background1.png');
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      font-family: 'Press Start 2P', system-ui, sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      overflow: hidden;
      transition: background-image 1s ease;
    }
    
    /* Add a container for the game canvas that will receive theme changes */
    #gameContainer {
      width: 800px;
      height: 300px;
      background: transparent;
      border-radius: 8px;
      transition: filter 1s ease;
      position: relative;
      z-index: 1;
      pointer-events: auto;
      visibility: visible !important;
      opacity: 1 !important;
    }
    
    /* Loading animation styles */
    #initial-loader {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      z-index: 1000;
      /* Ensure loader is not affected by theme changes */
      filter: none;
    }
    
    .top-row, .bottom-row { 
      position: absolute; 
      left: 50%; /* Center horizontally */ 
      transform: translateX(-50%); /* Adjust because left: 50% puts the left edge at center */ 
      display: flex; 
      justify-content: center; 
      align-items: center;
      filter: none; 
    } 
    
    /* Specifically place them pixel-wise */ 
    .top-row { 
      top: 48%; /* slightly above the center */ 
    } 
    
    .bottom-row { 
      top: 52%; /* slightly below the center */ 
    }
    
    .diamond { 
      width: 25px; 
      height: 25px; 
      background: rgb(255, 247, 140); 
      transform: rotate(45deg); 
      margin: 10px; 
      filter: none;
      /* Remove transition for diamonds to keep color constant */ 
    } 
    
    /* Use consistent color for all diamonds */
    .diamond.active { 
      background-color: #ffd700; 
      box-shadow: 0 0 15px rgba(255, 215, 0, 0.8); 
    }

    .modal {
      display: flex;
      justify-content: center;
      align-items: center;
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0, 0, 0, 0.85);
      backdrop-filter: blur(8px);
      z-index: 1001;
      opacity: 1;
      transition: opacity 0.3s ease;
    }
    .modal-content {
      background: linear-gradient(145deg, #2a2a2a, #1a1a1a);
      padding: 30px;
      border-radius: 15px;
      text-align: center;
      color: #fff;
      font-family: 'Press Start 2P', cursive;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.5),
                 inset 0 0 15px rgba(255, 255, 255, 0.1);
      max-width: 600px;
      width: 90%;
      border: 1px solid rgba(255, 255, 255, 0.1);
      animation: modalAppear 0.5s ease-out;
    }
    @keyframes modalAppear {
      from {
        transform: scale(0.8);
        opacity: 0;
      }
      to {
        transform: scale(1);
        opacity: 1;
      }
    }
    .modal-content p {
      line-height: 1.8;
      margin: 0 0 20px 0;
      color: #fff;
      text-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
    }
    #yeswyButton {
      margin-top: 25px;
      padding: 15px 30px;
      font-size: 18px;
      cursor: pointer;
      background: linear-gradient(45deg, #ff6b6b, #ff8e8e);
      border: none;
      border-radius: 8px;
      color: white;
      font-family: 'Press Start 2P', cursive;
      text-transform: uppercase;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(255, 107, 107, 0.4);
    }
    #yeswyButton:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(255, 107, 107, 0.6);
      background: linear-gradient(45deg, #ff8e8e, #ff6b6b);
    }
    #yeswyButton:active {
      transform: translateY(1px);
      box-shadow: 0 2px 10px rgba(255, 107, 107, 0.4);
    }

    canvas {
      display: block;
      max-width: 100%;
      height: auto;
      background: transparent;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    #score {
      position: fixed;
      top: 20px;
      left: 20px;
      font-size: 14px;
      color: #FFF;
      background: rgba(0, 0, 0, 0.5);
      padding: 10px 15px;
      border-radius: 8px;
      z-index: 100;
      font-family: 'Press Start 2P', monospace;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
      /* Ensure score is not affected by theme changes */
      filter: none;
    }
    
    #themeAnnouncement {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 24px;
      color: #FFFFFF;
      background: rgba(0, 0, 0, 0.7);
      padding: 15px 25px;
      border-radius: 10px;
      font-family: 'Press Start 2P', monospace;
      display: none;
      text-align: center;
      z-index: 3;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
      opacity: 0;
      transition: opacity 0.5s ease;
    }

    #gameOverMessage {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 26px;
      color: #FFFFFF;
      font-family: 'Press Start 2P', monospace;
      display: none;
      text-align: center;
      z-index: 2;
      text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.8);
      transition: color 1s ease, font-family 1s ease, text-shadow 1s ease;
      background: rgba(0, 0, 0, 0.8);
      padding: 20px;
      border-radius: 10px;
    }

    .game-over-btn {
      margin: 20px 10px;
      padding: 10px 20px;
      font-size: 16px;
      font-family: 'Press Start 2P', monospace;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
    }

    #restartBtn {
      background: linear-gradient(45deg, #4CAF50, #45a049);
      color: white;
    }

    #spotifyBtn {
      background: linear-gradient(45deg, #1DB954, #1aa34a);
      color: white;
    }

    .game-over-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }

    .ground {
      fill: #32CD32; /* Vibrant green */
    }

    .cloud {
      fill: #FFFFFF; /* White */
    }
  </style>
</head>
<body>
  <!-- Loading animation container -->
  <div id="initial-loader">
    <div class="top-row">
      <div id="diamond1" class="diamond"></div>
      <div id="diamond2" class="diamond"></div>
      <div id="diamond3" class="diamond"></div>
      <div id="diamond4" class="diamond"></div>
    </div>
    <div class="bottom-row">
      <div id="diamond5" class="diamond"></div>
      <div id="diamond6" class="diamond"></div>
      <div id="diamond7" class="diamond"></div>
    </div>
  </div>
  
  <div id="gameContainer">
    <canvas id="gameCanvas"></canvas>
  </div>
  <div id="score">Score: 0</div>
  <div id="gameOverMessage">
    khel khatam
    <br><br>
    <button id="restartBtn" class="game-over-btn">restart</button>
    <button id="spotifyBtn" class="game-over-btn">go to spotify!!</button>
  </div>
  <div id="themeAnnouncement"></div>
  
  <!-- Include loading animation script -->
  <script>
    // Remove local storage logic
    const modal = document.getElementById('termsModal');
    const yeswyButton = document.getElementById('yeswyButton');
    
    // Ensure modal is displayed only once per session
    modal.style.display = 'flex';
    
    // Initialize audio element with proper handling
    let backgroundMusic = new Audio('SpotiMate.io - ESWY - Aman Sagar.mp3');
    
    // Reset and reload audio when page becomes visible
    document.addEventListener('visibilitychange', () => {
      if (document.visibilityState === 'visible') {
        backgroundMusic.pause();
        backgroundMusic = new Audio('SpotiMate.io - ESWY - Aman Sagar.mp3');
        if (modal.style.display === 'none') {
          backgroundMusic.play().catch(error => console.log('Audio playback failed:', error));
        }
      }
    });
    
    function initializeLoadingAnimation() {
      const loadingContainer = document.getElementById('initial-loader');
      const diamonds = loadingContainer.querySelectorAll('.diamond');
    
      let currentIndex = 0;
      let animationInterval;
      let cycles = 0;
      const maxCycles = 1;
    
      loadingContainer.style.filter = 'none';
    
      function activateDiamond() {
        diamonds.forEach(diamond => diamond.classList.remove('active'));
        
        if (currentIndex >= diamonds.length) {
          currentIndex = 0;
          cycles++;
    
          if (cycles >= maxCycles) {
            clearInterval(animationInterval);
            setTimeout(() => {
              loadingContainer.style.display = 'none';
            }, 300);
            return;
          }
        }
        
        diamonds[currentIndex].classList.add('active');
        currentIndex++;
      }
    
      return {
        start: () => {
          loadingContainer.style.display = 'grid';
          animationInterval = setInterval(activateDiamond, 300);
        }
      };
    }
    
    // Start loading animation and game
    yeswyButton.addEventListener('click', () => {
      modal.style.display = 'none';
      
      // Start background music
      backgroundMusic.play().catch(error => console.log('Audio playback failed:', error));
      
      // Start loading animation after modal is closed
      const loadingAnimation = initializeLoadingAnimation();
      loadingAnimation.start();
    });
    
    // Ensure game container remains visible and functional
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    const restartBtn = document.getElementById("restartBtn");
    const spotifyBtn = document.getElementById("spotifyBtn");
    
    // Add button event listeners
    restartBtn.addEventListener("click", () => {
      resetGame();
      gameOverMessage.style.display = "none";
    });
    
    spotifyBtn.addEventListener("click", () => {
      window.location.href = "https://open.spotify.com/track/1yazBO7fdWNDUcr3uuRbTr";
    });
    
    function resetGame() {
      score = 0;
      gameSpeed = 2.5;
      obstacles = [];
      gameOver = false;
      dino.y = canvas.height - 60;
      dino.jumping = false;
      dino.velocity = 0;
      dino.jumpCount = 0;
      scoreElement.textContent = "Score: 0";
      currentThemeIndex = 0;
      currentTheme = themes[currentThemeIndex];
      document.getElementById('gameContainer').style.filter = currentTheme.filter;
      document.body.style.backgroundImage = `url('${currentTheme.backgrounds[0]}')`;
    }
    
    // Responsive sizing
    let canvasWidth = Math.min(window.innerWidth * 0.95, 800);
    let canvasHeight = Math.min(window.innerHeight * 0.6, 300);
    canvas.width = canvasWidth;
    canvas.height = canvasHeight;
    
    const scoreElement = document.getElementById("score");
    const gameOverMessage = document.getElementById("gameOverMessage");
    
    const frogSprite1 = new Image();
    frogSprite1.src = "frogbaba1.png";
    const frogSprite2 = new Image();
    frogSprite2.src = "frogbaba2.png";
    const frogJumpSprite = new Image();
    frogJumpSprite.src = "frogbaba3.png";
    
    const tallLotus = new Image();
    tallLotus.src = "lotus1.png";
    const shortLotus = new Image();
    shortLotus.src = "lotus2.png";
    
    // Sky elements
    const sun = {
      x: canvasWidth - 70,
      y: 60,
      radius: 30,
      glow: 40
    };
    
    const stars = [];
    for (let i = 0; i < 20; i++) {
      stars.push({
        x: Math.random() * canvas.width,
        y: Math.random() * (canvas.height / 2),
        size: Math.random() * 2 + 1,
        twinkle: Math.random() * 0.5 + 0.5
      });
    }
    
    const dino = {
      x: 50,
      y: canvas.height - 60,
      width: 50,
      height: 50,
      jumping: false,
      velocity: 0,
      gravity: 0.6,
      jumpForce: -12,
      currentSprite: frogSprite1,
      jumpCount: 0,
      maxJumps: 4,
    };
    
    let obstacles = [];
    let clouds = [];
    let score = 0;
    let frameCount = 0;
    let gameOver = false;
    let gameSpeed = 2.5; // Reduced initial game speed
    const groundY = canvas.height - 10;
    
    // Theme system - changes every 400 points
    const themes = [
    {
      name: "Dark Sepia",
      skyColors: ['#2b1a0f', '#3e2617', '#5e3b1f', '#7c5430'],
      sunColors: ['#e1b07e', '#c48a47', '#8b5a2b'],
      sunGlowColor: 'rgba(225, 176, 126, 0.4)',
      starColor: '#f4dab3',
      cloudColor: '#bca18a',
      groundColors: ['#5e3b1f', '#4c2d18', '#3a2111'],
      grassColor: '#8c6239',
      textColor: '#ffe1b3',
      fontFamily: "'Press Start 2P', 'Courier New', monospace",
      filter: 'sepia(0.7) brightness(0.9) contrast(1.1)',
      backgrounds: ['background1.png', 'background2.png', 'background3.png', 'background4.png', 'background5.png', 'background6.png', 'background7.png']
    },
      {
        name: "Janam 2",
        skyColors: ['#fff5e6', '#ffecd9', '#ffe4cc', '#ffdbba'],
        sunColors: ['#ffcc80', '#ffb74d', '#ffa726'],
        sunGlowColor: 'rgba(255, 167, 38, 0.4)',
        starColor: '#d4a257',
        cloudColor: '#fff9f2',
        groundColors: ['#e6c9a3', '#d4b38c', '#c19b76'],
        grassColor: '#d4b892',
        textColor: '#5c4023',
        fontFamily: "'Press Start 2P', 'Source Code Pro', monospace",
        filter: 'sepia(0.35) brightness(1.15) saturate(1.1) contrast(1.05)',
        backgrounds: ['background1.png']
      },
      {
          name: "Janam 3",
          skyColors: ['#000000', '#111111', '#222222', '#333333'],
          moonColors: ['#e0e0e0', '#cccccc', '#b3b3b3'],
          moonGlowColor: 'rgba(224, 224, 224, 0.4)',
          starColor: '#ffffff',
          cloudColor: '#f0f0f0',
          groundColors: ['#1a1a1a', '#2a2a2a', '#3a3a3a'],
          grassColor: '#4d4d4d',
          textColor: '#ffffff',
          fontFamily: "'Times New Roman', 'Press Start 2P', serif",
          filter: 'grayscale(1) contrast(1.3)',
          backgrounds: ['background1.png', 'background2.png', 'background3.png', 'background4.png', 'background5.png', 'background6.png', 'background7.png'],
          isMoon: true
      },
      {
          name: "Janam 4",
          skyColors: ['#f9f9f9', '#ededed', '#e0e0e0', '#d4d4d4'],
          sunColors: ['#ffffff', '#f5f5f5', '#ebebeb'],
          sunGlowColor: 'rgba(245, 245, 245, 0.4)',
          starColor: '#b0b0b0',
          cloudColor: '#ffffff',
          groundColors: ['#c0c0c0', '#a8a8a8', '#8f8f8f'],
          grassColor: '#b3b3b3',
          textColor: '#333333',
          fontFamily: "'Arial', 'Press Start 2P', sans-serif",
          filter: 'grayscale(0.85) brightness(1.15)',
          backgrounds: ['background1.png', 'background2.png', 'background3.png', 'background4.png', 'background5.png', 'background6.png', 'background7.png']
      },
      {
          name: "Janam 5",
          skyColors: ['#2c1810', '#3c1d12', '#4d2315', '#5e2817'],
          sunColors: ['#ff6b3d', '#e65c33', '#cc4d29'],
          sunGlowColor: 'rgba(255, 107, 61, 0.3)',
          starColor: '#ffd700',
          cloudColor: '#4a2416',
          groundColors: ['#1e0f0a', '#2a1610', '#361c15'],
          grassColor: '#4d2315',
          textColor: '#ffd700',
          fontFamily: "'Press Start 2P', monospace",
          filter: 'brightness(0.9) contrast(1.2) saturate(1.1)',
          backgrounds: ['background1.png', 'background2.png', 'background3.png', 'background4.png', 'background5.png', 'background6.png', 'background7.png']
        },
        {
          name: "Janam 6",
          skyColors: ['#d3cfff', '#beb3f5', '#a998e6', '#9380d4'],
          sunColors: ['#fff3ff', '#ffd6ff', '#e5b3f0'],
          sunGlowColor: 'rgba(255, 221, 255, 0.4)',
          starColor: '#fceaff',
          cloudColor: '#ffffff',
          groundColors: ['#c0a3ff', '#a97ff0', '#8f5fdc'],
          grassColor: '#dab3ff',
          textColor: '#4b007d',
          fontFamily: "'Orbitron', 'Press Start 2P', sans-serif",
          filter: 'contrast(1.1) brightness(1.05) saturate(1.1)',
          backgrounds: ['background1.png', 'background2.png', 'background3.png', 'background4.png', 'background5.png', 'background6.png', 'background7.png']
        },
        {
          name: "Janam 7",
          skyColors: ['#e6f3ff', '#d9edff', '#cce7ff', '#bfe1ff'],
          sunColors: ['#ffeb3b', '#fdd835', '#fbc02d'],
          sunGlowColor: 'rgba(255, 235, 59, 0.3)',
          starColor: '#b0b0b0',
          cloudColor: '#ffffff',
          groundColors: ['#4caf50', '#43a047', '#388e3c'],
          grassColor: '#66bb6a',
          textColor: '#2c2c2c',
          fontFamily: "'Inter', 'Arial', sans-serif",
          filter: 'brightness(1.05) contrast(1.05)',
          backgrounds: ['background1.png', 'background2.png', 'background3.png', 'background4.png', 'background5.png', 'background6.png', 'background7.png']
        }
    ];
    
    let currentThemeIndex = 0;
    let currentTheme = themes[currentThemeIndex];
    
    // Apply initial theme
    scoreElement.style.fontFamily = currentTheme.fontFamily;
    scoreElement.style.color = currentTheme.textColor;
    gameOverMessage.style.fontFamily = currentTheme.fontFamily;
    
    // Obstacle generation variables
    let lastObstacleTime = Date.now();
    const minObstacleGap = 1500; 
    const obstacleChance = 0.01; 
    
    // More varied and naturalistic clouds
    for (let i = 0; i < 8; i++) {
      clouds.push({
        x: Math.random() * canvas.width,
        y: 20 + Math.random() * 40,
        width: 60 + Math.random() * 40,
        height: 20 + Math.random() * 15,
        speed: 0.2 + Math.random() * 0.3,
        segments: 3 + Math.floor(Math.random() * 3),
        opacity: 0.7 + Math.random() * 0.3
      });
    }

    // Grass tufts for enhanced ground detail
    const grassTufts = [];
    for (let i = 0; i < canvasWidth; i += 10) {
      grassTufts.push({
        x: i,
        height: 3 + Math.random() * 7,
        width: 1 + Math.random() * 2
      });
    }

    function update() {
      if (gameOver) return;

      if (dino.jumping) {
        dino.velocity += dino.gravity;
        dino.y += dino.velocity;

        if (dino.y >= canvas.height - 60) {
          dino.y = canvas.height - 60;
          dino.jumping = false;
          dino.velocity = 0;
          dino.jumpCount = 0;
        }
      }

      // Add obstacles with proper minimum gap and lower spawn rate
      const now = Date.now();
      if (now - lastObstacleTime > minObstacleGap && Math.random() < obstacleChance) {
        lastObstacleTime = now;

        const isTall = Math.random() > 0.7;
        obstacles.push({
          x: canvas.width,
          y: canvas.height - (isTall ? 70 : 40),
          width: isTall ? 50 : 40,
          height: isTall ? 60 : 30,
          isTall: isTall,
        });
      }

      obstacles.forEach(ob => ob.x -= gameSpeed);
      obstacles = obstacles.filter(ob => ob.x + ob.width > 0);

      clouds.forEach(cloud => {
        cloud.x -= cloud.speed;
        if (cloud.x + cloud.width < 0) {
          cloud.x = canvas.width;
          cloud.y = 20 + Math.random() * 40;
          cloud.opacity = 0.7 + Math.random() * 0.3;
        }
      });

      // Twinkle stars
      stars.forEach(star => {
        star.twinkle = Math.max(0.5, Math.min(1, star.twinkle + (Math.random() - 0.5) * 0.1));
      });

      // Collision detection with reduced hitbox for more forgiving gameplay
      for (let ob of obstacles) {
        // Reduced hitbox size (80% of visual size)
        const hitboxReduction = 0.2;
        const dinoHitboxWidth = dino.width * (1 - hitboxReduction);
        const dinoHitboxHeight = dino.height * (1 - hitboxReduction);
        const obHitboxWidth = ob.width * (1 - hitboxReduction);
        const obHitboxHeight = ob.height * (1 - hitboxReduction);
        
        // Adjusted hitbox positions
        const dinoHitboxX = dino.x + (dino.width - dinoHitboxWidth) / 2;
        const dinoHitboxY = dino.y + (dino.height - dinoHitboxHeight) / 2;
        const obHitboxX = ob.x + (ob.width - obHitboxWidth) / 2;
        const obHitboxY = ob.y + (ob.height - obHitboxHeight) / 2;
        
        if (
          dinoHitboxX < obHitboxX + obHitboxWidth &&
          dinoHitboxX + dinoHitboxWidth > obHitboxX &&
          dinoHitboxY < obHitboxY + obHitboxHeight &&
          dinoHitboxY + dinoHitboxHeight > obHitboxY
        ) {
          gameOver = true;
          gameOverMessage.style.display = "block";
        }
      }

      score++;
      const displayScore = Math.floor(score / 10);
      scoreElement.textContent = `Score: ${displayScore}`;
      
      // Change background at 300 points
      // Update background based on score
      const backgroundIndex = Math.floor(displayScore / 100) % 7;
      const currentThemeBackgrounds = themes[currentThemeIndex].backgrounds;
      document.body.style.backgroundImage = `url('${currentThemeBackgrounds[backgroundIndex]}')`;


      // Check if we need to change theme (every 300 points)
      const themeScore = Math.floor(displayScore / 300);
      const newThemeIndex = themeScore % themes.length;
      
      if (newThemeIndex !== currentThemeIndex) {
        currentThemeIndex = newThemeIndex;
        currentTheme = themes[currentThemeIndex];
        
        // Apply new theme only to game container, not the score bar or body
        const gameContainer = document.getElementById('gameContainer');
        gameContainer.style.filter = currentTheme.filter;
        // Remove any filter from body to ensure it doesn't affect other elements
        document.body.style.filter = 'none';
        // Keep score element styling consistent
        gameOverMessage.style.fontFamily = currentTheme.fontFamily;
        gameOverMessage.style.color = currentTheme.textColor;
        
        // Show theme announcement
        const themeAnnouncement = document.getElementById("themeAnnouncement");
        themeAnnouncement.textContent = `Theme: ${currentTheme.name}`;
        themeAnnouncement.style.fontFamily = currentTheme.fontFamily;
        themeAnnouncement.style.color = currentTheme.textColor;
        themeAnnouncement.style.display = "block";
        
        // Fade in and out animation
        setTimeout(() => {
          themeAnnouncement.style.opacity = "1";
          
          setTimeout(() => {
            themeAnnouncement.style.opacity = "0";
            
            setTimeout(() => {
              themeAnnouncement.style.display = "none";
            }, 500);
          }, 2000);
        }, 0);
        
        console.log(`Theme changed to: ${currentTheme.name}`);
      }
      
      // Slower game speed increase rate
      gameSpeed += 0.0005;
    }

    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // Draw sky gradient using current theme
      const skyGradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
      skyGradient.addColorStop(0, currentTheme.skyColors[0]);    // Top color
      skyGradient.addColorStop(0.3, currentTheme.skyColors[1]);  // Upper middle
      skyGradient.addColorStop(0.6, currentTheme.skyColors[2]);  // Lower middle
      skyGradient.addColorStop(1, currentTheme.skyColors[3]);    // Horizon
      
      ctx.fillStyle = skyGradient;
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      
      // Draw background elements based on theme
      if (currentThemeIndex === 0) {
        // Draw mountains in first theme with parallax effect
        const mountainOffset = (score * 0.3) % canvas.width;
        
        // Create multiple mountain ranges with different parallax speeds
        // Background mountains (slowest)
        ctx.fillStyle = '#2b1810';
        for (let i = 0; i < 8; i++) {
          const offset = (-mountainOffset * 0.5 + i * canvas.width/3) % (canvas.width * 2);
          ctx.beginPath();
          ctx.moveTo(offset - canvas.width/2, canvas.height);
          ctx.quadraticCurveTo(
            offset + 200, canvas.height - 180 - Math.sin(i) * 10,
            offset + canvas.width/2, canvas.height
          );
          ctx.fill();
        }
        
        // Middle mountains
        ctx.fillStyle = '#3d2915';
        for (let i = 0; i < 6; i++) {
          const offset = (-mountainOffset * 0.7 + i * canvas.width/4) % (canvas.width * 2);
          ctx.beginPath();
          ctx.moveTo(offset - canvas.width/2, canvas.height);
          ctx.quadraticCurveTo(
            offset + 150, canvas.height - 190 - Math.sin(i * 1.5) * 20,
            offset + canvas.width/2, canvas.height
          );
          ctx.fill();
        }
        
        // Foreground mountains (fastest)
        ctx.fillStyle = '#4a3b2c';
        for (let i = 0; i < 7; i++) {
          const offset = (-mountainOffset * 0.9 + i * canvas.width/5) % (canvas.width * 2);
          ctx.beginPath();
          ctx.moveTo(offset - canvas.width/2, canvas.height);
          ctx.quadraticCurveTo(
            offset + 100, canvas.height - 140 - Math.sin(i * 2) * 15,
            offset + canvas.width/2, canvas.height
          );
          ctx.fill();
        }
      } else if (currentThemeIndex === 5) { // Y2K Theme
        const buildingOffset = (score * 0.5) % canvas.width;
        
        // Draw neon grid background
        ctx.strokeStyle = 'rgba(255, 0, 255, 0.2)';
        ctx.lineWidth = 1;
        for (let i = 0; i < canvas.width; i += 20) {
          const offset = (i - buildingOffset) % canvas.width;
          ctx.beginPath();
          ctx.moveTo(offset, 0);
          ctx.lineTo(offset, canvas.height);
          ctx.stroke();
        }
        
        // Draw Y2K buildings
        for (let i = 0; i < 6; i++) {
          const buildingX = ((i * canvas.width/3 - buildingOffset) % (canvas.width * 2)) - canvas.width/2;
          const height = 100 + Math.sin(i * 1.5) * 30;
          
          // Main building body
          ctx.fillStyle = `rgba(${180 + i * 20}, ${100 + i * 20}, ${255}, 0.8)`;
          ctx.fillRect(buildingX, canvas.height - height, 80, height);
          
          // Neon outlines
          ctx.strokeStyle = '#ff00ff';
          ctx.lineWidth = 2;
          ctx.strokeRect(buildingX, canvas.height - height, 80, height);
          
          // Windows
          for (let y = 10; y < height - 10; y += 20) {
            for (let x = 10; x < 70; x += 20) {
              ctx.fillStyle = `rgba(255, 255, ${200 + Math.sin(Date.now() * 0.001 + i) * 55}, 0.9)`;
              ctx.fillRect(buildingX + x, canvas.height - height + y, 10, 10);
            }
          }
        }
      } else if (currentThemeIndex === 6) { // Modern Minimal Theme
        const buildingOffset = (score * 0.4) % canvas.width;
        
        // Draw modern buildings
        for (let i = 0; i < 5; i++) {
          const buildingX = ((i * canvas.width/2.5 - buildingOffset) % (canvas.width * 2)) - canvas.width/2;
          const height = 120 + Math.cos(i * 0.8) * 40;
          
          // Main building shape
          ctx.fillStyle = `rgba(${220 + i * 5}, ${220 + i * 5}, ${220 + i * 5}, 0.9)`;
          ctx.beginPath();
          ctx.moveTo(buildingX, canvas.height);
          ctx.lineTo(buildingX, canvas.height - height);
          ctx.lineTo(buildingX + 100, canvas.height - height - 20);
          ctx.lineTo(buildingX + 100, canvas.height);
          ctx.fill();
          
          // Geometric details
          ctx.fillStyle = `rgba(${200 + i * 10}, ${200 + i * 10}, ${200 + i * 10}, 0.7)`;
          for (let j = 20; j < height; j += 30) {
            ctx.fillRect(buildingX + 10, canvas.height - j, 80, 5);
          }
          
          // Glass panels
          ctx.fillStyle = 'rgba(240, 240, 240, 0.3)';
          for (let y = 10; y < height - 30; y += 40) {
            ctx.fillRect(buildingX + 20, canvas.height - height + y, 60, 25);
          }
        }
      } else if (currentThemeIndex === 1) {
        // Draw mountains and detailed trees in second theme with parallax
        const mountainOffset2 = (score * 0.3) % canvas.width;
        
        // Mountains with smooth curves
        ctx.fillStyle = '#4a3b2c';
        ctx.beginPath();
        ctx.moveTo(-mountainOffset2, canvas.height);
        ctx.quadraticCurveTo(150 - mountainOffset2, canvas.height - 170, 300 - mountainOffset2, canvas.height - 90);
        ctx.quadraticCurveTo(450 - mountainOffset2, canvas.height - 140, 600 - mountainOffset2, canvas.height - 80);
        ctx.quadraticCurveTo(750 - mountainOffset2, canvas.height - 130, 900 - mountainOffset2, canvas.height);
        ctx.lineTo(canvas.width, canvas.height);
        ctx.fill();
        
        // Detailed Trees
        for(let x = 50; x < canvas.width + 120; x += 120) {
          const treeX = x - (score * 0.8) % 120;
          
          // Tree trunk with detail
          ctx.fillStyle = '#3d2b1f';
          ctx.fillRect(treeX - 5, canvas.height - 120, 10, 30);
          
          // Detailed tree top
          ctx.fillStyle = '#5e3b1e';
          ctx.beginPath();
          ctx.moveTo(treeX, canvas.height - 120);
          ctx.lineTo(treeX - 20, canvas.height - 90);
          ctx.lineTo(treeX, canvas.height - 110);
          ctx.lineTo(treeX - 10, canvas.height - 80);
          ctx.lineTo(treeX, canvas.height - 100);
          ctx.lineTo(treeX + 10, canvas.height - 80);
          ctx.lineTo(treeX, canvas.height - 110);
          ctx.lineTo(treeX + 20, canvas.height - 90);
          ctx.closePath();
          ctx.fill();
          
          // Add small nuances (leaves/branches)
          ctx.fillStyle = '#4d2e17';
          for(let i = 0; i < 5; i++) {
            const leafX = treeX + Math.cos(Date.now() * 0.001 + i) * 15;
            const leafY = canvas.height - 110 + Math.sin(Date.now() * 0.001 + i) * 5;
            ctx.beginPath();
            ctx.arc(leafX, leafY, 2, 0, Math.PI * 2);
            ctx.fill();
          }
        }
      } else if (currentThemeIndex === 2) {
        // Draw tall mountains in third theme
        ctx.fillStyle = '#2b1810';
        ctx.beginPath();
        ctx.moveTo(0, canvas.height - 120);
        ctx.lineTo(200, canvas.height - 220);
        ctx.lineTo(400, canvas.height - 150);
        ctx.lineTo(600, canvas.height - 200);
        ctx.lineTo(canvas.width, canvas.height - 180);
        ctx.lineTo(canvas.width, canvas.height);
        ctx.lineTo(0, canvas.height);
        ctx.fill();
      } else if (currentThemeIndex === 3) {
        // Draw birds and additional scenery in fourth theme
        // Birds
        ctx.fillStyle = '#000000';
        for(let i = 0; i < 5; i++) {
          const x = (canvas.width / 6) * i + 100;
          const y = 50 + Math.sin(Date.now() / 1000 + i) * 10;
          
          ctx.beginPath();
          ctx.moveTo(x, y);
          ctx.lineTo(x + 10, y - 5);
          ctx.lineTo(x + 20, y);
          ctx.stroke();
        }
        
        // Additional scenery (distant mountains)
        ctx.fillStyle = '#1a1a1a';
        ctx.beginPath();
        ctx.moveTo(0, canvas.height - 60);
        ctx.lineTo(150, canvas.height - 120);
        ctx.lineTo(300, canvas.height - 80);
        ctx.lineTo(450, canvas.height - 140);
        ctx.lineTo(600, canvas.height - 90);
        ctx.lineTo(canvas.width, canvas.height - 110);
        ctx.lineTo(canvas.width, canvas.height);
        ctx.lineTo(0, canvas.height);
        ctx.fill();
      }
      
      // Draw stars with theme color
      ctx.fillStyle = currentTheme.starColor;
      stars.forEach(star => {
        ctx.globalAlpha = star.twinkle;
        ctx.beginPath();
        ctx.arc(star.x, star.y, star.size, 0, Math.PI * 2);
        ctx.fill();
      });
      ctx.globalAlpha = 1;
      
      // Draw sun/moon with themed gradient and glow
      if (currentTheme.isMoon) {
        // Draw moon with crater details
        const moonGradient = ctx.createRadialGradient(
          sun.x, sun.y, 0,
          sun.x, sun.y, sun.radius
        );
        moonGradient.addColorStop(0, currentTheme.moonColors[0]);
        moonGradient.addColorStop(0.8, currentTheme.moonColors[1]);
        moonGradient.addColorStop(1, currentTheme.moonColors[2]);
        
        ctx.fillStyle = moonGradient;
        ctx.beginPath();
        ctx.arc(sun.x, sun.y, sun.radius, 0, Math.PI * 2);
        ctx.fill();
        
        // Moon glow
        ctx.save();
        ctx.globalAlpha = 0.2;
        const moonGlowGradient = ctx.createRadialGradient(
          sun.x, sun.y, sun.radius,
          sun.x, sun.y, sun.radius + sun.glow
        );
        moonGlowGradient.addColorStop(0, currentTheme.moonColors[1]);
        moonGlowGradient.addColorStop(1, currentTheme.moonGlowColor);
        
        ctx.fillStyle = moonGlowGradient;
        ctx.beginPath();
        ctx.arc(sun.x, sun.y, sun.radius + sun.glow, 0, Math.PI * 2);
        ctx.fill();
        
        // Add moon craters
        ctx.globalAlpha = 0.3;
        ctx.fillStyle = '#d3d3d3';
        ctx.beginPath();
        ctx.arc(sun.x - 10, sun.y - 5, 8, 0, Math.PI * 2);
        ctx.fill();
        ctx.beginPath();
        ctx.arc(sun.x + 8, sun.y + 10, 6, 0, Math.PI * 2);
        ctx.fill();
        ctx.restore();
      } else {
        // Draw sun with themed gradient and glow
        const sunGradient = ctx.createRadialGradient(
          sun.x, sun.y, 0,
          sun.x, sun.y, sun.radius
        );
        sunGradient.addColorStop(0, currentTheme.sunColors[0]);
        sunGradient.addColorStop(0.8, currentTheme.sunColors[1]);
        sunGradient.addColorStop(1, currentTheme.sunColors[2]);
        
        ctx.fillStyle = sunGradient;
        ctx.beginPath();
        ctx.arc(sun.x, sun.y, sun.radius, 0, Math.PI * 2);
        ctx.fill();
        
        // Sun glow with theme color
        ctx.save();
        ctx.globalAlpha = 0.2;
        const glowGradient = ctx.createRadialGradient(
          sun.x, sun.y, sun.radius,
          sun.x, sun.y, sun.radius + sun.glow
        );
        glowGradient.addColorStop(0, currentTheme.sunColors[1]);
        glowGradient.addColorStop(1, currentTheme.sunGlowColor);
        
        ctx.fillStyle = glowGradient;
        ctx.beginPath();
        ctx.arc(sun.x, sun.y, sun.radius + sun.glow, 0, Math.PI * 2);
        ctx.fill();
        ctx.restore();
      }

      // Draw themed clouds
      clouds.forEach(cloud => {
        ctx.save();
        ctx.globalAlpha = cloud.opacity;
        
        // Multiple connected circles for more natural cloud shapes
        ctx.fillStyle = currentTheme.cloudColor;
        ctx.beginPath();
        
        const centerX = cloud.x + cloud.width / 2;
        const baseY = cloud.y;
        
        // Main cloud body
        ctx.arc(centerX, baseY, cloud.width / 3, 0, Math.PI * 2);
        
        // Add bumps around the cloud
        for (let i = 0; i < cloud.segments; i++) {
          const angle = (i / cloud.segments) * Math.PI * 2;
          const offsetX = Math.cos(angle) * (cloud.width / 2.5);
          const offsetY = Math.sin(angle) * (cloud.height / 2.5);
          const size = (0.5 + Math.sin(i) * 0.5) * cloud.width / 4;
          
          ctx.arc(centerX + offsetX, baseY + offsetY, size, 0, Math.PI * 2);
        }
        
        ctx.fill();
        ctx.restore();
      });

      // Enhanced ground with themed colors
      // Base ground
      const groundGradient = ctx.createLinearGradient(0, groundY - 20, 0, canvas.height);
      groundGradient.addColorStop(0, currentTheme.groundColors[0]);  // Light color at top
      groundGradient.addColorStop(0.5, currentTheme.groundColors[1]); // Medium color
      groundGradient.addColorStop(1, currentTheme.groundColors[2]);   // Dark color at bottom
      
      ctx.fillStyle = groundGradient;
      ctx.fillRect(0, groundY - 5, canvas.width, canvas.height - groundY + 5);
      
      // Add texture pattern to ground
      ctx.fillStyle = currentTheme.groundColors[1] + '80'; // 50% opacity
      for(let i = 0; i < canvas.width; i += 15) {
        for(let j = groundY; j < canvas.height; j += 10) {
          if (Math.random() > 0.7) {
            ctx.fillRect(i + Math.random() * 5, j + Math.random() * 5, 2, 2);
          }
        }
      }
      
      // Draw detailed grass tufts with theme color
      ctx.fillStyle = currentTheme.grassColor;
      grassTufts.forEach(tuft => {
        // Grass blades
        ctx.beginPath();
        ctx.moveTo(tuft.x, groundY - 5);
        ctx.lineTo(tuft.x - tuft.width, groundY - 5 - tuft.height);
        ctx.lineTo(tuft.x + tuft.width, groundY - 5);
        ctx.fill();
        
        ctx.beginPath();
        ctx.moveTo(tuft.x, groundY - 5); 
        ctx.lineTo(tuft.x + tuft.width, groundY - 5 - tuft.height);
        ctx.lineTo(tuft.x + tuft.width * 2, groundY - 5);
        ctx.fill();
      });

      // Draw the player frog
      if (dino.jumping) {
        ctx.drawImage(frogJumpSprite, dino.x, dino.y, dino.width, dino.height);
      } else {
        frameCount++;
        if (frameCount > 15) {
          frameCount = 0;
          dino.currentSprite = dino.currentSprite === frogSprite1 ? frogSprite2 : frogSprite1;
        }
        ctx.drawImage(dino.currentSprite, dino.x, dino.y, dino.width, dino.height);
      }

      // Draw obstacles (lotus)
      obstacles.forEach(ob => {
        const sprite = ob.isTall ? tallLotus : shortLotus;
        ctx.drawImage(sprite, ob.x, ob.y, ob.width, ob.height);
      });
      
    }

    function loop() {
      update();
      draw();
      requestAnimationFrame(loop);
    }

    // Keyboard & touch controls
    function jump() {
      if (!gameOver && (dino.jumpCount < dino.maxJumps)) {
        dino.velocity = dino.jumpForce;
        dino.jumping = true;
        dino.jumpCount++;
      }
    }

    window.addEventListener("keydown", (e) => {
      if (e.code === "Space") {
        if (gameOver) {
          resetGame();
          gameOverMessage.style.display = "none";
          return;
        }
        jump();
      } else if (e.code === "KeyR") {
        resetGame();
        gameOverMessage.style.display = "none";
      }
    });

    window.addEventListener("touchstart", () => {
      jump();
    });

    // Initialize and start the loading animation
    const loadingAnimation = initializeLoadingAnimation();
    
    // Apply initial theme to loading animation
    const initialLoader = document.getElementById("initial-loader");
    initialLoader.style.background = `rgba(${currentTheme.groundColors[0].replace(/[^0-9,]/g, '')}, 0.8)`;
    
    // Start the animation
    loadingAnimation.start();
    
    // Wait for assets to load before starting the game
    // Proper window load event
window.addEventListener('load', () => {
  const yeswyBtn = document.getElementById('yeswyButton');
  const modal = document.getElementById('termsModal');

  // Attach event listener safely
  yeswyBtn.addEventListener('click', function () {
    modal.style.display = 'none';
    startGame(); // Start the game only after accepting terms
  });

  // Optional: prevent game start if user tries to jump before accepting
  window.addEventListener("keydown", (e) => {
    if (e.code === "Space" && modal.style.display !== 'none') {
      e.preventDefault();
    } else if (e.code === "Space") {
      jump();
    }
  });

  window.addEventListener("touchstart", () => {
    if (modal.style.display === 'none') jump();
  });

  // Initialize loading animation and theme
  const loadingAnimation = initializeLoadingAnimation();
  const initialLoader = document.getElementById("initial-loader");
  initialLoader.style.background = `rgba(${currentTheme.groundColors[0].replace(/[^0-9,]/g, '')}, 0.8)`;
  loadingAnimation.start();
});

// Game start is now fully controlled by modal button
function startGame() {
  setTimeout(() => {
    loop(); // Start game loop
    console.log('Game started');
  }, 1500);
}

  </script>
</body>
</html>
